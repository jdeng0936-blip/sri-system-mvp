# 🎬 任务：多模态"绞肉机"升级

## 痛点

现代销售现场产生大量非文本资料：
- 🎙️ **客户访谈录音** (MP3/WAV) - 含关键需求信息
- 🎬 **现场实勘视频** (MP4) - 含环境和痛点描述

当前 RAG 引擎只能"看懂"PDF/TXT，导致这些宝贵知识无法入库、无法检索、无法在问答中引用。

---

## 目标

让武器库支持音频和视频文件，通过转录将其转化为可检索的文本知识。

---

## 技术要求

### 1. 音频转录能力

在 `utils/rag_engine.py` 的 `process_document()` 方法中：

**当前代码：**
```python
elif file_ext in ['mp4', 'mp3', 'wav']:
    content = f"[多媒体文件] {file_name}\n(多媒体文件已记录，待实现转录功能)"
```

**升级为：**
- 检测到 MP3/WAV/M4A 文件时，调用 **OpenAI Whisper API** 进行转录
- 转录文本格式：`[音频转录] 文件名\n\n转录内容...`
- 转录后的文本自动向量化并存入 ChromaDB
- 异常处理：API失败、文件过大(>25MB)、格式不支持

### 2. 视频处理能力

- MP4/MOV 文件：提取音轨 → 转录（或直接发送给Whisper，API支持视频）
- 转录文本格式：`[视频转录] 文件名\n\n转录内容...`
- 文件大小限制：>25MB 时提示用户

### 3. API密钥管理

- 从环境变量读取：`os.environ.get('OPENAI_API_KEY')`
- 如未配置，返回占位文本：`"[音频文件] xxx.mp3\n(需要配置OpenAI API密钥)"`
- API密钥已在 `app.py` 侧边栏输入，需要传递给 RAG 引擎

### 4. 依赖确认

确保已安装：
```bash
pip install openai
```

Whisper API 不需要额外依赖。

---

## 验收标准

- [ ] 上传 MP3 文件 → 自动转录 → 存入知识库
- [ ] 搜索转录内容 → 能找到相关片段
- [ ] 问答引用 → AI 能引用音频内容回答
- [ ] 异常处理 → 优雅降级，不崩溃

---

## 测试方式

1. 录制 30 秒音频（内容：产品参数介绍）
2. 上传到武器库
3. 观察是否显示"正在转录..."
4. 搜索音频中提到的关键词
5. 在第一现场提问，验证 AI 是否引用音频内容

---

## 约束

- 转录费用：Whisper API $0.006/分钟，注意成本提示
- 文件大小：超过 25MB 拒绝处理
- 网络超时：转录失败时回退到占位文本
- 前端兼容：不修改 `app.py` 上传逻辑，只升级后端解析

---

**完成后输出执行摘要。**
